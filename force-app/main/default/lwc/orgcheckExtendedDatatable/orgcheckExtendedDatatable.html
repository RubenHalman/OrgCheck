<template>
    <template if:true={usesDependencyViewer}>
        <c-orgcheck-dependency-viewer></c-orgcheck-dependency-viewer>
    </template>
    <template if:true={showStatistics}>
        Total number of rows: <b><code>{nbRows}</code></b>,&nbsp;
        Total number of bad rows: <b><code>{nbBadRows}</code></b>,&nbsp;
        Total sum score: <b><code>{sumScore}</code></b>,&nbsp;
        <template if:true={isFilterOn}>
            Filter is <b><code>on</code></b>,&nbsp;
            Number of rows that match the filter: <b><code>{nbRowsVisible}</code></b>,&nbsp;
        </template>
        <template if:false={isFilterOn}>
            Filter is <b><code>off</code></b>,&nbsp;
        </template>
        Sorted by <b><code>{sortingField}</code></b> (<b><code>{sortingOrder}</code></b>)&nbsp;
    </template>
    <template if:true={showSearch}>
        <div id="search-box">
            <lightning-input 
                placeholder="Search any string field values (more than 2 characters)"
                onchange={handleSearchInputChanged}>
            </lightning-input>
        </div>
    </template>
    <table class={tableClasses} data-last-changed={lastChange}>
        <thead>
            <tr>
                <template for:each={columns} for:item="column">
                    <th key={column.label} onclick={handleSortColumnClick} aria-colindex={column.index} aria-label={column.label} tabindex={column.index} class={column.cssClass}>
                        {column.label}
                    </th>
                </template>
            </tr>            
        </thead>
        <tbody>
            <template for:each={rows} for:item="row">
                <tr key={row.key} class={row.cssClass}>
                    <template for:each={row.cells} for:item="cell">
                        <td key={cell.key} data-value={cell.value} class={cell.cssClass}>
                            <template lwc:if={cell.isIndex}>
                                {row.index}
                            </template>
                            <template lwc:elseif={cell.isScore}>
                                {row.score}
                            </template>
                            <template lwc:elseif={cell.isEmpty}>
                                {cell.value}
                            </template>
                            <template lwc:elseif={cell.isDependencyViewer}>
                                <c-orgcheck-dependency-link onview={handleViewDependency} dependencies={cell.value} whatid={cell.id} whatname={cell.name}></c-orgcheck-dependency-link>
                            </template>
                            <template lwc:elseif={cell.isId}>
                                <lightning-formatted-url value={cell.url} tooltip={cell.value} label={cell.value} target="_blank" ></lightning-formatted-url>
                            </template>
                            <template lwc:elseif={cell.isPercentage}>
                                <lightning-formatted-number value={cell.value} maximum-fraction-digits="2" format-style="percent"></lightning-formatted-number>
                            </template>
                            <template lwc:elseif={cell.isNumeric}>
                                <template lwc:if={cell.isMaxReached}>
                                    {cell.value}
                                </template>
                                <template lwc:elseif={cell.isMinReached}>
                                    {cell.value}
                                </template>
                                <template lwc:else>
                                    <lightning-formatted-number value={cell.value} maximum-fraction-digits="0" format-style="decimal"></lightning-formatted-number>
                                </template>
                            </template>
                            <template lwc:elseif={cell.isBoolean}>
                                <div class="slds-text-align_center">
                                    <template lwc:if={cell.value}>
                                        <lightning-icon icon-name="standard:task2" alternative-text="True" size="x-small"></lightning-icon>
                                    </template>
                                    <template lwc:else>
                                        <lightning-icon icon-name="standard:first_non_empty" alternative-text="False" size="x-small"></lightning-icon>
                                    </template>
                                </div>
                            </template>
                            <template lwc:elseif={cell.isDateTime}>
                                <template lwc:if={cell.value}><lightning-formatted-date-time value={cell.value}></lightning-formatted-date-time></template>
                            </template>
                            <template lwc:elseif={cell.isText}>
                                {cell.value}
                                <template lwc:if={cell.isValueTruncated}>
                                    &nbsp;<lightning-icon icon-name="utility:more" alternative-text="..." size="x-small"></lightning-icon>
                                </template>
                            </template>
                            <template lwc:elseif={cell.isTexts}>
                                <i>{cell.values.length} item(s)</i><br />
                                <template for:each={cell.values} for:item="item">
                                    - {item.value}
                                    <template lwc:if={item.isValueTruncated}>
                                        &nbsp;<lightning-icon key={cell.key} icon-name="utility:more" alternative-text="..." size="x-small"></lightning-icon>
                                    </template>
                                    <br key={cell.key} />
                                </template>
                            </template>
                            <template lwc:elseif={cell.isIds}>
                                <i>{cell.values.length} item(s)</i><br />
                                <template for:each={cell.values} for:item="item">
                                    <template lwc:if={item}>
                                        - <lightning-formatted-url key={item} value={item.url} tooltip={item.value} label={item.value} target="_blank" ></lightning-formatted-url><br key={cell.key} />
                                    </template>
                                </template>
                            </template>
                            <template lwc:else>
                                type we don't have yet for {cell.value}
                            </template>
                        </td>
                    </template>
                </tr>
            </template>
        </tbody>
    </table>
    <span id="footer">
        <template lwc:if={isDataEmpty}>
            {emptyMessage}
        </template>
        <template if:true={areAllRowsInvisible}>
            No data to show with this filter.
        </template>
    </span>
</template>